-- 테이블 순서는 관계를 고려하여 한 번에 실행해도 에러가 발생하지 않게 정렬되었습니다.

-- USER Table Create SQL
CREATE TABLE USER
(
    `USER_ID`               INT             NOT NULL    AUTO_INCREMENT COMMENT '식별번호', 
    `EMAIL`                 VARCHAR(45)     NOT NULL    COMMENT '이메일', 
    `PASSWORD`              VARCHAR(200)    NOT NULL    COMMENT '비밀번호', 
    `BAD_PASSWORD_COUNT`    INT             NULL        COMMENT '비밀번호오류횟수', 
    `PASSWORD_CHANGE_DATE`  DATE            NULL        COMMENT '비밀번호변경일', 
    `STATUS`                VARCHAR(10)     NOT NULL    COMMENT '상태', 
    PRIMARY KEY (USER_ID)
);

ALTER TABLE USER COMMENT '사용자';


-- COIN Table Create SQL
CREATE TABLE COIN
(
    `COIN_ID`    INT            NOT NULL    AUTO_INCREMENT COMMENT '식별번호', 
    `COIN_NAME`  VARCHAR(45)    NOT NULL    COMMENT '코인명', 
    PRIMARY KEY (COIN_ID)
);

ALTER TABLE COIN COMMENT '코인';


-- TRADING_RECORD Table Create SQL
CREATE TABLE TRADING_RECORD
(
    `TRADING_RECORD_ID`  INT               NOT NULL    AUTO_INCREMENT COMMENT '식별번호', 
    `USER_ID`            INT               NOT NULL    COMMENT '유저식별번호', 
    `COIN_ID`            INT               NOT NULL    COMMENT '코인식별번호', 
    `TRADING_TYPE`       VARCHAR(20)       NOT NULL    COMMENT '거래종류', 
    `QUANTITY`           INT               NOT NULL    COMMENT '거래량', 
    `PRICE`              DECIMAL(18, 2)    NOT NULL    COMMENT '거래단가', 
    `AMOUNT`             DECIMAL(18, 2)    NOT NULL    COMMENT '거래금액', 
    `COMMISSION`         DECIMAL(18, 2)    NULL        COMMENT '수수료', 
    `TRADING_DT`         DATETIME          NOT NULL    COMMENT '거래일시', 
    PRIMARY KEY (TRADING_RECORD_ID)
);

ALTER TABLE TRADING_RECORD COMMENT '거래내역';

ALTER TABLE TRADING_RECORD ADD CONSTRAINT FK_TRADING_RECORD_COIN_ID_COIN_COIN_ID FOREIGN KEY (COIN_ID)
 REFERENCES COIN (COIN_ID)  ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE TRADING_RECORD ADD CONSTRAINT FK_TRADING_RECORD_USER_ID_USER_USER_ID FOREIGN KEY (USER_ID)
 REFERENCES USER (USER_ID)  ON DELETE RESTRICT ON UPDATE RESTRICT;


-- ASSET Table Create SQL
CREATE TABLE ASSET
(
    `ASSET_ID`  INT    NOT NULL    AUTO_INCREMENT COMMENT '식별번호', 
    `USER_ID`   INT    NOT NULL    COMMENT '유저식별번호', 
    `COIN_ID`   INT    NOT NULL    COMMENT '코인식별번호', 
    `QUANTITY`  INT    NOT NULL    COMMENT '보유량', 
    PRIMARY KEY (ASSET_ID)
);

ALTER TABLE ASSET COMMENT '자산';

ALTER TABLE ASSET ADD CONSTRAINT FK_ASSET_USER_ID_USER_USER_ID FOREIGN KEY (USER_ID)
 REFERENCES USER (USER_ID)  ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE ASSET ADD CONSTRAINT FK_ASSET_COIN_ID_COIN_COIN_ID FOREIGN KEY (COIN_ID)
 REFERENCES COIN (COIN_ID)  ON DELETE RESTRICT ON UPDATE RESTRICT;


